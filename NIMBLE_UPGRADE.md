# üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ NimBLE-Arduino 2.3.6

## ‚úÖ –ß—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ

### üì¶ –í–µ—Ä—Å–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- **platformio.ini**: –û–±–Ω–æ–≤–ª–µ–Ω–∞ –≤–µ—Ä—Å–∏—è —Å `^1.4.1` –Ω–∞ `^2.3.6`

### üîß API –∏–∑–º–µ–Ω–µ–Ω–∏—è

#### 1. –ö–æ–ª–ª–±—ç–∫–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤
```cpp
// –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è (1.x):
void onConnect(NimBLEServer* pServer) { ... }
void onDisconnect(NimBLEServer* pServer) { ... }

// –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è (2.x):
void onConnect(NimBLEServer* pServer, NimBLEConnInfo& connInfo) { ... }
void onDisconnect(NimBLEServer* pServer, NimBLEConnInfo& connInfo, int reason) { ... }
```

#### 2. –ö–æ–ª–ª–±—ç–∫–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
```cpp
// –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è:
void onRead(NimBLECharacteristic* pChar, ble_gap_conn_desc* desc) { ... }

// –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è:
void onRead(NimBLECharacteristic* pChar, NimBLEConnInfo& connInfo) { ... }
```

#### 3. –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Å–≤–æ–π—Å—Ç–≤ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
```cpp
// –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è:
NIMBLE_PROPERTY::NOTIFY | NIMBLE_PROPERTY::READ
NIMBLE_PROPERTY::WRITE | NIMBLE_PROPERTY::WRITE_NR

// –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è:
BLE_GATT_CHR_PROP_NOTIFY | BLE_GATT_CHR_PROP_READ
BLE_GATT_CHR_PROP_WRITE | BLE_GATT_CHR_PROP_WRITE_NO_RSP
```

#### 4. –ú–µ—Ç–æ–¥—ã Advertising
```cpp
// –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è:
pAdvertising->setScanResponse(true);
pAdvertising->setMinPreferred(0x06);
pAdvertising->setMaxPreferred(0x06);

// –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è:
pAdvertising->enableScanResponse(true);
pAdvertising->setPreferredParams(0x06, 0x06);
```

#### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ—â–Ω–æ—Å—Ç–∏
```cpp
// –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è:
NimBLEDevice::setPower(ESP_PWR_LVL_P9);

// –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è:
NimBLEDevice::setPower(9); // –ü—Ä—è–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ dBm
```

#### 6. –£–¥–∞–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã
```cpp
// –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –±–æ–ª—å—à–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –≤–µ—Ä—Å–∏–∏ 2.x:
pTxCharacteristic->getSubscribedCount()

// –†–µ—à–µ–Ω–∏–µ: —Å—Ç–µ–∫ —Å–∞–º —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∞–º–∏,
// –ø—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–π—Ç–µ notify() –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫
pTxCharacteristic->notify();
```

## üöÄ –ö–æ–º–ø–∏–ª—è—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

### –ß–µ—Ä–µ–∑ VS Code + PlatformIO
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ PlatformIO IDE
2. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ VS Code
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É PlatformIO —Å–ª–µ–≤–∞
4. –í—ã–±–µ—Ä–∏—Ç–µ "Build" –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Ctrl+Alt+B

### –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PlatformIO Core, –µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ:
pip install platformio

# –ö–æ–º–ø–∏–ª—è—Ü–∏—è:
pio run

# –ü—Ä–æ—à–∏–≤–∫–∞:
pio run --target upload

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
pio device monitor -p COM_PORT
```

### –ß–µ—Ä–µ–∑ Arduino IDE (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É ESP32 –≤ Arduino IDE
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫—É "NimBLE-Arduino" –≤–µ—Ä—Å–∏–∏ 2.3.6
3. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `src/main.cpp`
4. –ü–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ –≤ `main.ino`
5. –í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç—É ESP32C3 Dev Module
6. –ö–æ–º–ø–∏–ª–∏—Ä—É–π—Ç–µ

## üÜï –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–µ—Ä—Å–∏–∏ 2.3.6

- **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞**: –î–æ 1650 –±–∞–π—Ç –¥–∞–Ω–Ω—ã—Ö
- **–£–ª—É—á—à–µ–Ω–∏—è isConnectable()**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–∞–µ–º–æ—Å—Ç–∏
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ Extended advertisements**: –ü–æ–ª–Ω–∞—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- **–û–±—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è**: –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### 1. –û—à–∏–±–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
```
error: 'BLE_GATT_CHR_PROPS_NOTIFY' was not declared
```
**–†–µ—à–µ–Ω–∏–µ**: –ó–∞–º–µ–Ω–∏—Ç–µ `BLE_GATT_CHR_PROPS_*` –Ω–∞ `BLE_GATT_CHR_PROP_*` (–±–µ–∑ S)

### 2. –û—à–∏–±–∫–∞ getSubscribedCount()
```  
error: 'class NimBLECharacteristic' has no member named 'getSubscribedCount'
```
**–†–µ—à–µ–Ω–∏–µ**: –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —É–¥–∞–ª–µ–Ω –≤ –≤–µ—Ä—Å–∏–∏ 2.x. –ü—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–π—Ç–µ `notify()` –Ω–∞–ø—Ä—è–º—É—é.

### 3. –û—à–∏–±–∫–∏ –∫–æ–ª–ª–±—ç–∫–æ–≤
```
error: cannot convert 'ble_gap_conn_desc*' to 'NimBLEConnInfo&'
```
**–†–µ—à–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–∏—Ç–µ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –∫–æ–ª–ª–±—ç–∫–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `NimBLEConnInfo&` –≤–º–µ—Å—Ç–æ `ble_gap_conn_desc*`

## üìã –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫

- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∞ –≤–µ—Ä—Å–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–æ 2.3.6
- [x] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
- [x] –û–±–Ω–æ–≤–ª–µ–Ω—ã –∫–æ–ª–ª–±—ç–∫–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤ –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫  
- [x] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã advertising
- [x] –£–±—Ä–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ getSubscribedCount()
- [x] –û–±–Ω–æ–≤–ª–µ–Ω setPower –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å dBm
- [x] –í—Å–µ GPS —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º —Å **NimBLE-Arduino 2.3.6** –∏ –≥–æ—Ç–æ–≤ –∫ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ GPS –ø–∞—Ä—Å–∏–Ω–≥–∞, UART-BLE –º–æ—Å—Ç–∞ –∏ –¥–∏—Å–ø–ª–µ–µ–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.