# –†–ï–®–ï–ù–ò–ï: –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ BLE –∫—ç—à–∞

## –ü—Ä–æ–±–ª–µ–º–∞

**ESP32 –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç:**
```
I (674) BLE: Registered service 6e400001-b5a3-f393-e0a9-e50e24dcca9e ‚úÖ
```

**nRF Connect –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
```
0000aaa0-0000-1000-8000-aabbccddeeff ‚ùå
```

**–ü—Ä–∏—á–∏–Ω–∞:** –¢–µ–ª–µ—Ñ–æ–Ω –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–ª –°–¢–ê–†–£–Æ GATT —Ç–∞–±–ª–∏—Ü—É –∏ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç –µ—ë!

---

## –†–µ—à–µ–Ω–∏–µ - 3 —à–∞–≥–∞

### –®–ê–ì 1: –û—á–∏—Å—Ç–∏—Ç—å bonding –Ω–∞ ESP32

**–ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ NVS (—É–¥–∞–ª—è–µ—Ç –≤—Å–µ bonding –∫–ª—é—á–∏):**

```bash
idf.py -p /dev/ttyUSB0 erase-flash
idf.py -p /dev/ttyUSB0 flash
```

**–ò–ª–∏ —á–∞—Å—Ç–∏—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (—Ç–æ–ª—å–∫–æ NVS –ø–∞—Ä—Ç–∏—Ü–∏—è):**

```bash
idf.py -p /dev/ttyUSB0 erase-nvs
idf.py -p /dev/ttyUSB0 flash
```

–ü–æ—Å–ª–µ –ø—Ä–æ—à–∏–≤–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```bash
idf.py -p /dev/ttyUSB0 monitor
```

–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞:
```
I (674) BLE: Registered service 6e400001-b5a3-f393-e0a9-e50e24dcca9e
```

---

### –®–ê–ì 2: –û—á–∏—Å—Ç–∏—Ç—å BLE –∫—ç—à –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ

#### Android (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï —à–∞–≥–∏!)

**–ú–µ—Ç–æ–¥ 1 - –ó–∞–±—ã—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö:**

1. –û—Ç–∫—Ä–æ–π—Ç–µ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Üí **Bluetooth**
2. –ù–∞–π–¥–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ `UM980_C6_GPS` –∏–ª–∏ `58:E6:C5:C5:18:22`
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ ‚öôÔ∏è (—à–µ—Å—Ç–µ—Ä–µ–Ω–∫–∞) —Ä—è–¥–æ–º —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º
4. –ù–∞–∂–º–∏—Ç–µ **"–ó–∞–±—ã—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ"** –∏–ª–∏ **"Unpair"**
5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É–¥–∞–ª–µ–Ω–∏–µ

**–ú–µ—Ç–æ–¥ 2 - –û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è nRF Connect:**

1. –û—Ç–∫—Ä–æ–π—Ç–µ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Üí **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
2. –ù–∞–π–¥–∏—Ç–µ **nRF Connect**
3. –ù–∞–∂–º–∏—Ç–µ **–•—Ä–∞–Ω–∏–ª–∏—â–µ** (Storage)
4. –ù–∞–∂–º–∏—Ç–µ **–û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ** (Clear Data)
5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ

**–ú–µ—Ç–æ–¥ 3 - –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à Bluetooth —Å–∏—Å—Ç–µ–º—ã (–†–ê–î–ò–ö–ê–õ–¨–ù–´–ô):**

1. –û—Ç–∫—Ä–æ–π—Ç–µ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Üí **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
2. –ù–∞–∂–º–∏—Ç–µ —Ç—Ä–∏ —Ç–æ—á–∫–∏ ‚ãÆ ‚Üí **–ü–æ–∫–∞–∑–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
3. –ù–∞–π–¥–∏—Ç–µ **Bluetooth**
4. –ù–∞–∂–º–∏—Ç–µ **–•—Ä–∞–Ω–∏–ª–∏—â–µ**
5. –ù–∞–∂–º–∏—Ç–µ **–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à** (Clear Cache)
6. –ù–∞–∂–º–∏—Ç–µ **–û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ** (Clear Data) - –û–°–¢–û–†–û–ñ–ù–û! –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï —Å–æ–ø—Ä—è–∂–µ–Ω–∏—è Bluetooth!
7. **–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω**

**–ú–µ—Ç–æ–¥ 4 - ADB –∫–æ–º–∞–Ω–¥—ã (–¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö, —Ç—Ä–µ–±—É–µ—Ç USB debugging):**

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –∫ –∫–æ–º–ø—å—é—Ç–µ—Ä—É
adb shell pm clear com.android.bluetooth
adb shell pm clear no.nordicsemi.android.mcp
adb reboot
```

#### iOS (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï —à–∞–≥–∏!)

**–ú–µ—Ç–æ–¥ 1 - –ó–∞–±—ã—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:**

1. –û—Ç–∫—Ä–æ–π—Ç–µ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Üí **Bluetooth**
2. –ù–∞–π–¥–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ `UM980_C6_GPS` (–±—É–∫–≤–∞ **i** —Å–ø—Ä–∞–≤–∞)
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ **i**
4. –ù–∞–∂–º–∏—Ç–µ **"–ó–∞–±—ã—Ç—å —ç—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ"** (Forget This Device)
5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ

**–ú–µ—Ç–æ–¥ 2 - –°–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–∏ (–†–ê–î–ò–ö–ê–õ–¨–ù–´–ô):**

1. –û—Ç–∫—Ä–æ–π—Ç–µ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Üí **–û—Å–Ω–æ–≤–Ω—ã–µ** (General)
2. **–ü–µ—Ä–µ–Ω–æ—Å –∏–ª–∏ —Å–±—Ä–æ—Å iPhone** (Transfer or Reset iPhone)
3. **–°–±—Ä–æ—Å** (Reset)
4. **–°–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–∏** (Reset Network Settings)
5. –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å
6. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:** –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï Wi-Fi –ø–∞—Ä–æ–ª–∏ –∏ Bluetooth —Å–æ–ø—Ä—è–∂–µ–Ω–∏—è!

**–ú–µ—Ç–æ–¥ 3 - –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å nRF Connect:**

1. –£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –∏–∫–æ–Ω–∫—É **nRF Connect**
2. –ù–∞–∂–º–∏—Ç–µ **–£–¥–∞–ª–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**
3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É–¥–∞–ª–µ–Ω–∏–µ
4. –û—Ç–∫—Ä–æ–π—Ç–µ **App Store**
5. –ù–∞–π–¥–∏—Ç–µ **nRF Connect**
6. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–Ω–æ–≤–æ

---

### –®–ê–ì 3: –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞

1. **–í—ã–∫–ª—é—á–∏—Ç–µ –∏ –≤–∫–ª—é—á–∏—Ç–µ Bluetooth** –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ
2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ nRF Connect** (–ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä–æ–π—Ç–µ –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ)
3. **–û—Ç–∫—Ä–æ–π—Ç–µ nRF Connect**
4. –ù–∞–∂–º–∏—Ç–µ **SCAN**
5. –ù–∞–π–¥–∏—Ç–µ `UM980_C6_GPS` (MAC: `58:E6:C5:C5:18:22`)
6. **–ù–∞–∂–º–∏—Ç–µ CONNECT** (–Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–º–æ—Ç—Ä–∏—Ç–µ!)
7. –í–≤–µ–¥–∏—Ç–µ PIN **123456** –∫–æ–≥–¥–∞ –ø–æ–ø—Ä–æ—Å–∏—Ç
8. –î–æ–∂–¥–∏—Ç–µ—Å—å "Connected"

**–¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ä–≤–∏—Å—ã:**

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
Unknown Service
  UUID: 6E400001-B5A3-F393-E0A9-E50E24DCCA9E ‚úÖ

  Unknown Characteristic
    UUID: 6E400003-B5A3-F393-E0A9-E50E24DCCA9E (TX)
    Properties: NOTIFY

  Unknown Characteristic
    UUID: 6E400002-B5A3-F393-E0A9-E50E24DCCA9E (RX)
    Properties: WRITE, WRITE WITHOUT RESPONSE
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –∫—ç—à –æ—á–∏—â–µ–Ω

### –ù–∞ ESP32 (–≤ –ª–æ–≥–∞—Ö):

–ü–æ—Å–ª–µ –Ω–æ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞:
```
I (xxx) BLE: Passkey action: 3
I (xxx) BLE: BLE PAIRING PIN CODE: 123456
```

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç —Ç–µ–ª–µ—Ñ–æ–Ω —Å–ø–∞—Ä–∏–≤–∞–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—ã–µ –∫–ª—é—á–∏).

### –ù–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ (–≤ nRF Connect):

–ü–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è UUID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:
```
6E400001-B5A3-F393-E0A9-E50E24DCCA9E ‚úÖ
```

**–ù–ï:**
```
0000AAA0-0000-1000-8000-AABBCCDDEEFF ‚ùå
```

---

## –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

### –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å –î–†–£–ì–û–ì–û —Ç–µ–ª–µ—Ñ–æ–Ω–∞/–ø–ª–∞–Ω—à–µ—Ç–∞

–≠—Ç–æ —Ç–æ—á–Ω–æ –ø–æ–∫–∞–∂–µ—Ç - –ø—Ä–æ–±–ª–µ–º–∞ –≤ ESP32 –∏–ª–∏ –≤ —Ç–µ–ª–µ—Ñ–æ–Ω–µ.

### –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ (Linux/macOS)

**Linux —Å bluetoothctl:**

```bash
bluetoothctl
scan on
# –ü–æ–¥–æ–∂–¥–∏—Ç–µ, –Ω–∞–π–¥–∏—Ç–µ UM980_C6_GPS
pair 58:E6:C5:C5:18:22
# –í–≤–µ–¥–∏—Ç–µ PIN 123456
connect 58:E6:C5:C5:18:22
```

**macOS —Å LightBlue Explorer:**

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ LightBlue Explorer –∏–∑ App Store
2. –ù–∞–π–¥–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
3. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ UUID —Å–µ—Ä–≤–∏—Å–æ–≤

---

## –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?

### –ö—ç—à GATT —Ç–∞–±–ª–∏—Ü—ã

–ö–æ–≥–¥–∞ —Ç–µ–ª–µ—Ñ–æ–Ω –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ BLE —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É –ø–µ—Ä–≤—ã–π —Ä–∞–∑:
1. –û–Ω —á–∏—Ç–∞–µ—Ç GATT —Ç–∞–±–ª–∏—Ü—É (—Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫)
2. **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ—ë –≤ –∫—ç—à** –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
3. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫—ç—à, **–ù–ï —á–∏—Ç–∞—è –∑–∞–Ω–æ–≤–æ!**

### Bonding –∫–ª—é—á–∏

–ö–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–ø–∞—Ä–∏–≤–∞–Ω–∏–µ:
1. –¢–µ–ª–µ—Ñ–æ–Ω –∏ ESP32 –æ–±–º–µ–Ω–∏–≤–∞—é—Ç—Å—è encryption keys
2. **–°–æ—Ö—Ä–∞–Ω—è—é—Ç –∏—Ö –≤ NVS** (Non-Volatile Storage)
3. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —ç—Ç–∏ –∫–ª—é—á–∏
4. **–í–º–µ—Å—Ç–µ —Å –∫–ª—é—á–∞–º–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è GATT –∫—ç—à!**

### –ß—Ç–æ –º–µ–Ω—è–ª–æ—Å—å –≤ –≤–∞—à–µ–º –∫–æ–¥–µ?

–í —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏ –±—ã–ª UUID `0000aaa0-...`
–í –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ UUID `6e400001-...`

–¢–µ–ª–µ—Ñ–æ–Ω:
- –ü–æ–¥–∫–ª—é—á–∏–ª—Å—è –∫ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏
- –ó–∞–∫—ç—à–∏—Ä–æ–≤–∞–ª UUID `0000aaa0-...`
- –í—ã –æ–±–Ω–æ–≤–∏–ª–∏ –ø—Ä–æ—à–∏–≤–∫—É –Ω–∞ ESP32
- –¢–µ–ª–µ—Ñ–æ–Ω –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è —Å–Ω–æ–≤–∞, **–∏—Å–ø–æ–ª—å–∑—É—è —Å—Ç–∞—Ä—ã–π –∫—ç—à!**

---

## –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
idf.py -p /dev/ttyUSB0 monitor
```

–ò –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –≤ nRF Connect. –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:

```
I (xxx) BLE: BLE CONNECTION EVENT: status=0 (SUCCESS)
I (xxx) BLE: ‚úÖ BLE Client connected! conn_handle=0
I (xxx) BLE: Connection established, initiating security/pairing...
I (xxx) BLE: Passkey action: 3
I (xxx) BLE: BLE PAIRING PIN CODE: 123456  ‚Üê –ù–æ–≤–æ–µ —Å–ø–∞—Ä–∏–≤–∞–Ω–∏–µ!
I (xxx) BLE: Encryption established successfully
I (xxx) BLE: MTU UPDATED: 517 bytes
```

–í nRF Connect –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å UUID:
```
6E400001-B5A3-F393-E0A9-E50E24DCCA9E ‚úÖ
```

---

## –ò—Ç–æ–≥

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö—ç—à BLE –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ
**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ bonding + –∫—ç—à + –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** UUID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `6E400001-...` (–Ω–µ `0000AAA0-...`)

–£–¥–∞—á–∏! üéØ
