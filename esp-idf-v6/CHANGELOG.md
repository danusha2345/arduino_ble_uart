# Журнал изменений ESP-IDF v6 порта

## [Unreleased] - 2025-11-04

### Создано
- ✅ Базовая структура ESP-IDF v6 проекта
- ✅ Модульная архитектура (main, BLE, WiFi, GPS, Display)
- ✅ CMake конфигурация для сборки
- ✅ Kconfig для настройки пинов через menuconfig
- ✅ Условная компиляция для ESP32-C3/C6/S3

### Конфигурация платформ

#### ESP32-C3
- OLED I2C дисплей (SSD1306)
- TFT SPI дисплей (ST7789V)
- Стандартные пины

#### ESP32-C6 Tenstar SuperMini ⭐
- **ТОЛЬКО TFT дисплей** ST7789V через esp_lcd
- Flash: 4MB
- LVGL v9.4.0
- Пины:
  - UART: RX=6, TX=7
  - SPI: MOSI=18, SCLK=19
  - TFT: DC=20, RST=21, BL=22
  - LED: GPIO8 (WS2812), GPIO15 (обычный)
- **НЕ используем TFT_eSPI**, только нативные драйверы

#### ESP32-S3
- OLED I2C дисплей (SSD1306)
- TFT SPI дисплей (ST7789V)
- Dual-core оптимизация

### Компоненты

#### LVGL v9.4.0
- ✅ Конфигурационный файл `lv_conf.h` создан
- ✅ CMakeLists.txt для LVGL готов
- ✅ Оптимизация для ESP32 (64KB буфер)
- ✅ Поддержка 16-bit цвета

#### Ring Buffer
- ✅ Потокобезопасная реализация с мьютексами
- ✅ TX буфер: 16KB для GPS -> BLE/WiFi
- ✅ RX буфер: 4KB для команд BLE/WiFi -> GPS

#### UART
- ✅ Инициализация на скорости 460800
- ✅ Задача FreeRTOS для обработки данных
- ✅ Двунаправленная связь с GPS модулем

### Документация
- ✅ README.md - основное руководство
- ✅ INTEGRATION_GUIDE.md - интеграция LVGL v9.4.0
- ✅ MIGRATION_NOTES.md - анализ проблем Arduino кода
- ✅ OVERVIEW.md - обзор проекта
- ✅ QUICK_START.md - быстрый старт для новичков

### Конфигурация сборки
- ✅ sdkconfig.defaults.esp32c3
- ✅ sdkconfig.defaults.esp32c6 (с настройками 4MB Flash)
- ✅ sdkconfig.defaults.esp32s3

### TODO (Не реализовано)

#### Критично
- [ ] BLE сервис (Nordic UART Service через NimBLE)
- [ ] WiFi AP и TCP сервер
- [ ] NMEA парсер (портирование с Arduino)

#### Важно
- [ ] LVGL UI для TFT дисплея
- [ ] Драйвер SSD1306 для OLED (C3/S3)
- [ ] Драйвер ST7789V через esp_lcd

#### Опционально
- [ ] OTA обновления
- [ ] Web интерфейс
- [ ] Сохранение настроек в NVS

### Исправлено из оригинального кода

1. **Неопределенные пины для C6**
   - Было: `SDA_PIN_C6` и `SCL_PIN_C6` не определены
   - Стало: Удалены, т.к. C6 использует только TFT

2. **Конфликты библиотек дисплеев**
   - Было: TFT_eSPI + esp_lcd одновременно для C6
   - Стало: Только esp_lcd + LVGL

3. **Смешанные абстракции**
   - Было: Arduino_GFX (C3), TFT_eSPI (S3), esp_lcd (C6)
   - Стало: Единый LVGL v9.4.0 для всех

4. **Добавлены недостающие определения**
   - LED_PIN и LED_PIN_2 для ESP32-C6
   - LCD_SPI_HOST для правильной работы SPI3

### Технические детали

#### Память
- ESP32-C6: 4MB Flash, партиция настроена
- Буферы: оптимизированы под реальное использование
- LVGL: 64KB памяти

#### Производительность
- FreeRTOS задачи вместо loop()
- Приоритеты задач настроены
- Dual-core на S3 (BLE+WiFi на ядре 0, данные на ядре 1)

#### Совместимость
- ESP-IDF v5.3+ (рекомендуется v5.3)
- LVGL v9.4.0 (строго)
- NimBLE из ESP-IDF

## Следующий релиз

Планируется полная реализация:
- BLE Nordic UART Service
- WiFi AP с TCP сервером
- Полный NMEA парсер
- LVGL UI с отображением GPS данных

---

**Автор**: Портировано с Arduino на ESP-IDF v6
**Дата**: 2025-11-04
**Лицензия**: MIT
