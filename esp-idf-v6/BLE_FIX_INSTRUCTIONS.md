# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é BLE

## –ü—Ä–æ–±–ª–µ–º–∞
–¢–µ–ª–µ—Ñ–æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π UUID: `0000aaa0-0000-1000-8000-aabbccddeeff`
–û–∂–∏–¥–∞–µ—Ç—Å—è Nordic UART Service UUID: `6E400001-B5A3-F393-E0A9-E50E24DCCA9E`

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã
1. **–ù–∞ ESP32-C6 –∑–∞–ø—É—â–µ–Ω–∞ —Å—Ç–∞—Ä–∞—è –ø—Ä–æ—à–∏–≤–∫–∞** (–∫–æ–¥ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π)
2. **–¢–µ–ª–µ—Ñ–æ–Ω –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–ª —Å—Ç–∞—Ä—É—é GATT —Ç–∞–±–ª–∏—Ü—É** (–¥–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–æ—à–∏–≤–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è!)

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –î–∞–∂–µ –µ—Å–ª–∏ –≤—ã –ø—Ä–æ—à–∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é, —Ç–µ–ª–µ—Ñ–æ–Ω –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞!

üìñ **–°–º. –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –æ—á–∏—Å—Ç–∫–µ –∫—ç—à–∞:** [BLE_CACHE_CLEAR.md](BLE_CACHE_CLEAR.md)

## –†–µ—à–µ–Ω–∏–µ

### –®–∞–≥ 1: –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å ESP-IDF v6

```bash
cd /home/user/arduino_ble_uart/esp-idf-v6

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å ESP-IDF v6 (–∫–æ–º–∞–Ω–¥–∞ –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –≤ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ)
# –í–∞—Ä–∏–∞–Ω—Ç—ã:
source ~/esp/esp-idf/export.sh  # –ï—Å–ª–∏ ESP-IDF –≤ ~/esp/esp-idf
source ~/.espressif/esp-idf/export.sh  # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—É—Ç—å
idf6  # –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω alias
```

### –®–∞–≥ 2: –û—á–∏—Å—Ç–∏—Ç—å –∏ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç

```bash
# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
idf.py fullclean

# –í—ã–±—Ä–∞—Ç—å —Ü–µ–ª–µ–≤—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
idf.py set-target esp32c6

# –°–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
idf.py build
```

### –®–∞–≥ 3: –ü—Ä–æ—à–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

```bash
# –ü—Ä–æ—à–∏—Ç—å (–∑–∞–º–µ–Ω–∏—Ç–µ /dev/ttyUSB0 –Ω–∞ –≤–∞—à –ø–æ—Ä—Ç)
idf.py -p /dev/ttyUSB0 flash

# –ò–ª–∏ –µ—Å–ª–∏ –ø–æ—Ä—Ç –¥—Ä—É–≥–æ–π:
# Linux: /dev/ttyUSB0, /dev/ttyACM0
# macOS: /dev/cu.usbserial-*
# Windows: COM3, COM4, etc.
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤
idf.py -p /dev/ttyUSB0 monitor

# –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ BLE:
# I (xxx) BLE: Registered service 6e400001-b5a3-f393-e0a9-e50e24dcca9e with handle=...
# I (xxx) BLE: Registered characteristic 6e400002-... (RX)
# I (xxx) BLE: Registered characteristic 6e400003-... (TX)
# I (xxx) BLE: Advertising started: UM980_C6_GPS (UUID in adv, name in scan rsp)
```

### –®–∞–≥ 5: –û—á–∏—Å—Ç–∏—Ç—å BLE –∫—ç—à –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ

**Android:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" ‚Üí "Bluetooth"
2. –ù–∞–π–¥–∏—Ç–µ "UM980_C6_GPS" –∏–ª–∏ "UM980_*_GPS"
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–Ω–∞—á–æ–∫ —à–µ—Å—Ç–µ—Ä–µ–Ω–∫–∏ ‚Üí "–ó–∞–±—ã—Ç—å"
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Bluetooth –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ
5. –ü–æ–≤—Ç–æ—Ä–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É

**iOS:**
1. "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" ‚Üí "Bluetooth"
2. –ù–∞–∂–º–∏—Ç–µ (i) —Ä—è–¥–æ–º —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º
3. "–ó–∞–±—ã—Ç—å —ç—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ"
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Bluetooth
5. –ü–æ–≤—Ç–æ—Ä–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å

### –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

–û—Ç–∫—Ä–æ–π—Ç–µ Nordic UART –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ –∏ –Ω–∞–π–¥–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:
- **–ò–º—è:** `UM980_C6_GPS` (–¥–ª—è ESP32-C6)
- **UUID —Å–µ—Ä–≤–∏—Å–∞:** `6E400001-B5A3-F393-E0A9-E50E24DCCA9E`

–ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç, –≤—ã —É–≤–∏–¥–∏—Ç–µ:
- –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ —Å–ø–∏—Å–∫–µ BLE —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
- –î–≤–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏: TX (6E400003) –∏ RX (6E400002)
- –ü–æ—Ç–æ–∫ NMEA –¥–∞–Ω–Ω—ã—Ö –æ—Ç GPS –º–æ–¥—É–ª—è

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: ESP-IDF –Ω–µ –Ω–∞–π–¥–µ–Ω

–ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ `idf.py` –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ESP-IDF v6:

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å ESP-IDF v6
cd ~
mkdir esp
cd esp
git clone --recursive --branch v6.0 https://github.com/espressif/esp-idf.git

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
cd esp-idf
./install.sh esp32c6

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source ~/esp/esp-idf/export.sh

# –î–æ–±–∞–≤–∏—Ç—å alias –≤ ~/.bashrc (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
echo 'alias idf6="source ~/esp/esp-idf/export.sh"' >> ~/.bashrc
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é ESP-IDF
idf.py --version  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å v6.0 –∏–ª–∏ –≤—ã—à–µ

# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ LVGL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
ls components/lvgl/src  # –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ñ–∞–π–ª—ã LVGL

# –ï—Å–ª–∏ LVGL –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:
cd components
git clone --depth 1 --branch v9.4.0 https://github.com/lvgl/lvgl.git
cd ..

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ
idf.py fullclean
idf.py build
```

### –ü—Ä–æ–±–ª–µ–º–∞: –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ—Ä—Ç—ã
ls /dev/tty*  # Linux/macOS
# –ò–ª–∏
ls /dev/cu.*  # macOS

# –î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É dialout (Linux)
sudo usermod -a -G dialout $USER
# –ü–µ—Ä–µ–∑–∞–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ
```

### –ü—Ä–æ–±–ª–µ–º–∞: BLE –≤—Å—ë –µ—â—ë –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —á–µ—Ä–µ–∑ serial monitor:**
   ```bash
   idf.py -p /dev/ttyUSB0 monitor
   ```

2. **–ò—â–∏—Ç–µ –æ—à–∏–±–∫–∏:**
   - `E (xxx) BLE: ...` - –æ—à–∏–±–∫–∏ BLE
   - `W (xxx) BLE: ...` - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è BLE

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é GATT:**
   –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏:
   ```
   I (xxx) BLE: Registered service 6e400001-...
   I (xxx) BLE: Registered characteristic 6e400002-... (RX)
   I (xxx) BLE: Registered characteristic 6e400003-... (TX)
   I (xxx) BLE: CCCD descriptor registered
   ```

4. **–û—á–∏—Å—Ç–∏—Ç–µ NVS (Non-Volatile Storage):**
   ```bash
   idf.py -p /dev/ttyUSB0 erase-flash
   idf.py -p /dev/ttyUSB0 flash
   ```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–¥–∞

–ö–æ–¥ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ **–ü–†–ê–í–ò–õ–¨–ù–´–ô**:

```c
// ble_service.c:37-39
static const ble_uuid128_t gatt_svr_svc_uuid =
    BLE_UUID128_INIT(0x9e, 0xca, 0xdc, 0x24, 0x0e, 0xe5, 0xa9, 0xe0,
                     0x93, 0xf3, 0xa3, 0xb5, 0x01, 0x00, 0x40, 0x6e);

// = 6E400001-B5A3-F393-E0A9-E50E24DCCA9E ‚úì

// Advertising –≤–∫–ª—é—á–∞–µ—Ç UUID —Å–µ—Ä–≤–∏—Å–∞ (ble_service.c:277-279):
adv_fields.uuids128 = &gatt_svr_svc_uuid;
adv_fields.num_uuids128 = 1;
adv_fields.uuids128_is_complete = 1;

// GATT —Å–µ—Ä–≤–∏—Å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ (ble_service.c:140-141):
.type = BLE_GATT_SVC_TYPE_PRIMARY,
.uuid = &gatt_svr_svc_uuid.u,
```

UUID `0x0000AAA0` –ù–ï –ù–ê–ô–î–ï–ù –Ω–∏–≥–¥–µ –≤ –∫–æ–¥–µ. –≠—Ç–æ —Å—Ç–∞—Ä–∞—è –ø—Ä–æ—à–∏–≤–∫–∞ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.

## –ò—Ç–æ–≥

**–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç–∞—Ä–∞—è –ø—Ä–æ—à–∏–≤–∫–∞ –Ω–∞ ESP32-C6
**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø—Ä–æ—à–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫–æ–¥ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Nordic UART Service –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º UUID
